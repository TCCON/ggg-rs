<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Explicitly specified Xgases - GGG-RS User Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GGG-RS User Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="explicitly-specified-xgases"><a class="header" href="#explicitly-specified-xgases">Explicitly specified Xgases</a></h1>
<p>This section allows you to list specific Xgas variables to copy, along with some or all of the ancillary variables needed to properly interpret them.
Usually, you will not specify each Xgas by hand, but instead will use the <a href="/write_public_netcdf/xgas_discovery.html">discovery</a> capability of the writer to automatically find each Xgas to copy.
However, variables explicitly listed in this section take precedence over those found by the discovery rules.
This leads to two cases where you might specify an Xgas in this section:</p>
<ol>
<li>The Xgas does not follow the common naming convention, thus making it difficult to discover with simple rules, or difficult
to map from the Xgas variable to the ancillary variable.</li>
<li>The Xgas needs a different way to handle one of its ancillary variables that the default discovery does.</li>
</ol>
<p>Each Xgas has the following options:</p>
<ul>
<li><code>xgas</code> (required): the variable name</li>
<li><code>gas</code> (required): the physical gas name, e.g., "co2" for all the various CO2 variables (regular, <code>wco2</code>, and <code>lco2</code>).
This is used to match up to, e.g., the priors which do not distinguish between the different spectra windows.</li>
<li><code>gas_long</code> (optional): the full name of the gas instead of its abbreviation, e.g. "carbon dioxide" for CO2. If not given,
then the configuration will try to find the <code>gas</code> value in its <a href="/write_public_netcdf/gas_proper_names.html"><code>[gas_long_names]</code></a> section and use that,
falling back on the <code>gas</code> value if the gas is not defined in the gas long names section.</li>
<li><code>prior_profile</code> (optional): how to copy the a priori profile.</li>
<li><code>prior_xgas</code> (optional): how to copy the a priori column average.</li>
<li><code>ak</code> (optional): how to copy the averaging kernels.</li>
<li><code>slant_bin</code> (optional): how to find the slant Xgas bin variable needed to expand the AKs.</li>
<li><code>traceability_scale</code> (optional): how to find the variable containing the WMO or analogous scale for this data.</li>
</ul>
<p><code>prior_profile</code>, <code>prior_xgas</code>, <code>ak</code>, <code>slant_bin</code>, and <code>traceability_scale</code> can all be defined following the syntax in the <a href="#ancillary-variable-specifications">ancillary variable specifications</a>.
Note that <code>slant_bin</code> is a special case in that it will only be used if the AKs are to be copied, but cannot be omitted in that case.</p>
<p>To illustrate the two main use cases for this section, here is an excerpt from the standard TCCON configuration:</p>
<pre><code class="language-toml">[[xgas]]
xgas = "xluft"
gas = "luft"
gas_long = "dry air"
prior_profile = { type = "omit" }
prior_xgas = { type = "omit" }
ak = { type = "omit" }

[[xgas]]
xgas = "xco2_x2019"
gas = "co2"
prior_profile = { type = "specified_if_first", private_name = "prior_1co2", public_name = "prior_co2" }
prior_xgas = { type = "specified_if_first", private_name = "prior_xco2_x2019", public_name = "prior_xco2" }
ak = { type = "specified_if_first", private_name = "ak_xco2" }
slant_bin = { type = "specified", private_name = "ak_slant_xco2_bin" }

[[xgas]]
xgas = "xwco2_x2019"
gas = "co2"
prior_profile = { type = "specified_if_first", private_name = "prior_1co2", public_name = "prior_co2" }
prior_xgas = { type = "specified_if_first", private_name = "prior_xwco2_x2019", public_name = "prior_xco2" }
ak = { type = "specified_if_first", private_name = "ak_xwco2" }
slant_bin = { type = "specified", private_name = "ak_slant_xwco2_bin" }
</code></pre>
<p>First we have <code>xluft</code>.
This variable would be discovered by the <a href="/write_public_netcdf/xgas_discovery.html#rules">default rule</a>; however, that rule will require prior information and AKs.
The prior information is not useful for Xluft, so we want to avoid copying that to reduce the number of extraneous variables, and there are no AKs for Xluft.
Thus we specify "omit" for each of these to tell the writer not to look for them.
We do not have to tell it to omit <code>slant_bin</code>, because omitting the AKs implicitly skips that, and <code>traceability_scale</code> can be left as normal because there is an "aicf_xluft_scale" variable in the private netCDF files.</p>
<p>Second we have <code>xco2_x2019</code> and <code>xwco2_x2019</code>.
(We have omitted the x2007 variables and <code>lco2_x2019</code> from the above example for brevity).
These would not be discovered by the <a href="/write_public_netcdf/xgas_discovery.html#rules">default rule</a>.
Further, the mapping to their prior and AK variables is unique: all the CO2 Xgas variables can share the prior profiles and column averages, and each "flavor" of CO2 (regular, wCO2, or lCO2) can use the same AKs whether it is on the X2007 or X2019 scale.
Thus, we not only define that these variables need copied, but that we want to rename the prior variables to just "prior_co2" and "prior_xco2" and only copy these the first time we find them.
We also ensure that the AKs and slant bins point to the correct variables.</p>
<h2 id="ancillary-variable-specifications"><a class="header" href="#ancillary-variable-specifications">Ancillary variable specifications</a></h2>
<p>The ancillary variables (prior profile, prior Xgas, AK, slant bin, and traceability scale) can be defined as one of the following six types:</p>
<ul>
<li><code>inferred</code>: indicates that this ancillary variable must be included and should not conflict with any other
variable. The private and public variable names will be inferred from the Xgas and gas names.</li>
<li><code>inferred_if_first</code>: similar to <code>inferred</code>, except that it is not an error if the variable already exists
in the public file. This is meant to support cases like described for CO2 above, where multiple Xgases share
a single ancillary variable - as long as one Xgas copies it, the other Xgases do not need to.
<strong>Note that the writer does not check that the existing variable's data are equal to what would be written for the new variable!</strong></li>
<li><code>opt_inferred_if_first</code>: similar to <code>inferred_if_first</code>, except that if the private variable does not exist,
then this variable will be skipped instead of causing an error. This is intended for <a href="/write_public_netcdf/xgas_discovery.html#rules">Xgas discovery rules</a> more than explicit Xgas definitions.</li>
<li><code>specified</code>: allows you to specify exactly which variable to copy with the <code>private_name</code> field. You can also
give the <code>public_name</code> field to indicate what the variable name in the output file should be; if that is omitted,
then the public variable will have the same name as the private variable. It is an error if the public variable
already exists.</li>
<li><code>specified_if_first</code>: similar to <code>specified</code>, except that it is not an error if the public variable already exists.
(This is analogous to the relationship between <code>inferred</code> and <code>inferred_if_first</code>). This has the same <code>private_name</code>
and <code>public_name</code> fields as <code>specified</code>.</li>
<li><code>omit</code>: indicates that this variable should not be copied.</li>
</ul>
<h2 id="ancillary-variable-name-inference"><a class="header" href="#ancillary-variable-name-inference">Ancillary variable name inference</a></h2>
<p>The writer uses the following rules when asked to infer ancillary variable names.
In these, <code>{xgas_var}</code> indicates the Xgas variable name and <code>{gas}</code> the physical gas name.</p>
<ul>
<li><code>prior_profile</code>: looks for a private variable named <code>prior_1{gas}</code> and writes to a variable named <code>prior_{gas}</code>.</li>
<li><code>prior_xgas</code>: looks for a private variable named <code>prior_{xgas_var}</code> and writes to the same variable.</li>
<li><code>ak</code>: looks for a private variable named <code>ak_{xgas_var}</code> and writes to the same variable.</li>
<li><code>slant_bin</code>: looks for a private variable named <code>ak_slant_{xgas_var}_bin</code>. This is not written, it is only used to expand
the AKs to one-per-spectrum.</li>
<li><code>traceability_scale</code>: looks for a private variable named <code>aicf_{xgas_var}_scale</code>. The result is always written to the
<code>wmo_or_analogous_scale</code> attribute of the Xgas variable; that cannot be altered by this configuration.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../write_public_netcdf/xgas_discovery.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../write_public_netcdf/gas_proper_names.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../write_public_netcdf/xgas_discovery.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../write_public_netcdf/gas_proper_names.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
