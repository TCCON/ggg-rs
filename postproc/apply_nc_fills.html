<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>apply_nc_fills - GGG-RS User Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././mdbook-admonish.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GGG-RS User Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/TCCON/ggg-rs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="apply_nc_fills"><a class="header" href="#apply_nc_fills">apply_nc_fills</a></h1>
<h2 id="purpose"><a class="header" href="#purpose">Purpose</a></h2>
<p><code>apply_nc_fills</code> can be used to convert values representating null data in a
netCDF file to the defined netCDF fill values.
That way, programs and packages like <a href="https://www.giss.nasa.gov/tools/panoply/">Panoply</a>
or Python's <a href="https://unidata.github.io/netcdf4-python/">netCDF4 package</a> will
correctly mask them when read in.
The netCDF writer can do this automatically, but you may still need to use this
separate program if, for example:</p>
<ul>
<li>you used the GGG2020 Python netCDF writer and didn't realize that it won't automatically
mask the null values from your <code>xx_sunrun.dat</code>, or</li>
<li>you have other null values that come in from an ancillary instrument that need to be
accounted for.</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p>This program uses a TOML file to specify what variables to filter.
(We may add a <code>quick</code> option in the future that takes the input on the command line,
but for now, the TOML file is required.)
You can generate an example TOML file with the <code>toml-template</code> subcommand, e.g.:</p>
<pre><code class="language-bash">$GGGPATH/bin/apply_nc_fills toml-template my-fills.toml
</code></pre>
<p>This command will create a new file, <code>my-fills.toml</code> with some examples of how to
specify which values to replace.</p>
<p>To actually replace the values, use the <code>toml</code> subcommand.
If you want to keep the original file and create a new file with the fill values inserted
(recommended), use the <code>--output</code> option:</p>
<pre><code class="language-bash">$GGGPATH/bin/apply_nc_fills toml \
    --nc-file $GGGPATH/install/current_results/pa20040721_20041222.private.nc \
    --output $GGGPATH/install/current_results/pa20040721_20041222.private.with-fills.nc \
    pa_fills.toml
</code></pre>
<p>This would use the rules in <code>pa_fills.toml</code> to replace bad values in <code>pa20040721_20041222.private.nc</code>
with fill values in <code>pa20040721_20041222.private.with-fills.nc</code>.</p>
<p>Alternatively, if you want to just modify a file without making a copy, use the <code>--in-place</code> flag:</p>
<pre><code class="language-bash">$GGGPATH/bin/apply_nc_fills toml \
    --nc-file $GGGPATH/install/current_results/pa20040721_20041222.private.nc \
    --in-place \
    pa_fills.toml
</code></pre>
<p>This would edit <code>pa20040721_20041222.private.nc</code> directly.</p>
<h2 id="toml-format"><a class="header" href="#toml-format">TOML format</a></h2>
<p>The TOML file will be a sequence of <code>[[replace]]</code> blocks.
Each one defines a rule to replace values in one variable with netCDF fill values.</p>
<p>Each block <em>must</em> have the field <code>varname</code>, which gives the name of the variable in
the netCDF file is applies to.</p>
<p>Each block <em>must</em> have <em>one</em> of the following sets of fields:</p>
<ul>
<li><code>approx</code>: values that are within floating point precision of this value are replaced with fills.</li>
<li><code>gt</code> and <code>lt</code>: values that are between these values (<code>gt &lt;= x &lt;= lt</code>) are replaced with fills.</li>
<li><code>equal</code>: values that are exactly equal to this value are replaced with fills.</li>
</ul>
<p><code>approx</code> and <code>gt + lt</code> can be used to filter floating point variables.
<code>equal</code> can be used to filter integer variables.</p>
<p>Each block <em>may</em> have the following:</p>
<ul>
<li><code>time_greater_than</code>: limits this rule to data for times greater than or equal to this value.</li>
<li><code>time_less_than</code>: limits this rule to data for times less than or equal to this value.</li>
</ul>
<p>Each of these must be in the format "YYYY-MM-DDThh:mm:ss", e.g. 12:34:56 on 31 Jan 2000 would
be <code>2000-01-31T12:34:56</code>.</p>
<p>Multiple blocks can be specified for the same variable.
This way, if there are different fill values for different time periods, or just multiple fill
values over the whole file, they can be handled.</p>
<h3 id="toml-example-snippets"><a class="header" href="#toml-example-snippets">TOML example snippets</a></h3>
<p>This first example will simple replace any values approximately equal to 60.0 in the <code>tins</code>
variable with fill values:</p>
<pre><code class="language-toml">[[replace]]
varname = "tins"
approx = 60.0
</code></pre>
<p>This second example similarly replaces values approximately equal to -99.0 in the <code>pout</code>
variable with fills, but only between 1 Jan 2010 and 12 June 2015:</p>
<pre><code class="language-toml">[[replace]]
varname = "pout"
approx = -99.0
time_greater_than = "2010-01-01T00:00:00"
time_less_than = "2015-06-12T00:00:00"
</code></pre>
<p>We could edit this example to replace the same values, but for <em>all</em> times after 1 Jan 2010
by omitting the <code>time_less_than</code> field:</p>
<pre><code class="language-toml">[[replace]]
varname = "pout"
approx = -99.0
time_greater_than = "2010-01-01T00:00:00"
</code></pre>
<p>If the approximate equality check is missing some value due to weird floating point rounding,
or if you just have a spectrum of fill values, use <code>gt</code> and <code>lt</code> to replace a range of values.
This example will replace all values between -1.5 and -0.5 in the <code>fvsi</code> variable:</p>
<pre><code class="language-toml">[[replace]]
varname = "fvsi"
gt = -1.5
lt = -0.5
</code></pre>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note"></a>
</div>
<div>
<p>Both <code>lt</code> and <code>gt</code> are required.
You can mimic an open-ended range by setting the open end to a very positive or negative value.</p>
</div>
</div>
<p>Finally, if you need to insert fills into an integer variable, use the <code>equal</code> field:</p>
<pre><code class="language-toml"># I don't know why you would put fill values in the day of year.
# But there just aren't that many integer variables in TCCON netCDF files.
[[replace]]
varname = "day"
equal = 367
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../postproc/write_public_netcdf/site_metadata.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../other_utils.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../postproc/write_public_netcdf/site_metadata.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../other_utils.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
